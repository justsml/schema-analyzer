/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var e=function(){return(e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function t(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}c((r=r.apply(e,t||[])).next())}))}function n(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var r="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},o="object"==typeof r&&r&&r.Object===Object&&r,i="object"==typeof self&&self&&self.Object===Object&&self,u=o||i||Function("return this")(),a=u.Symbol,c=Object.prototype,s=c.hasOwnProperty,l=c.toString,f=a?a.toStringTag:void 0;var p=Object.prototype.toString;var h=a?a.toStringTag:void 0;function d(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":h&&h in Object(e)?function(e){var t=s.call(e,f),n=e[f];try{e[f]=void 0;var r=!0}catch(e){}var o=l.call(e);return r&&(t?e[f]=n:delete e[f]),o}(e):function(e){return p.call(e)}(e)}function y(e){return null!=e&&"object"==typeof e}function v(e){return"symbol"==typeof e||y(e)&&"[object Symbol]"==d(e)}var b=Array.isArray,g=a?a.prototype:void 0,_=g?g.toString:void 0;function m(e){if("string"==typeof e)return e;if(b(e))return function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}(e,m)+"";if(v(e))return _?_.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function j(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function w(e){return e}function O(e){if(!j(e))return!1;var t=d(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var S,A=u["__core-js_shared__"],k=(S=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+S:"";var T=Function.prototype.toString;function N(e){if(null!=e){try{return T.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var E=/^\[object .+?Constructor\]$/,P=Function.prototype,R=Object.prototype,D=P.toString,F=R.hasOwnProperty,z=RegExp("^"+D.call(F).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function $(e){return!(!j(e)||(t=e,k&&k in t))&&(O(e)?z:E).test(N(e));var t}function x(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return $(n)?n:void 0}var q=x(u,"WeakMap"),I=function(){try{var e=x(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),M=/^(?:0|[1-9]\d*)$/;function U(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&M.test(e))&&e>-1&&e%1==0&&e<t}function C(e,t){return e===t||e!=e&&t!=t}function L(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}var B=Object.prototype;function Y(e){return y(e)&&"[object Arguments]"==d(e)}var V=Object.prototype,W=V.hasOwnProperty,G=V.propertyIsEnumerable,Q=Y(function(){return arguments}())?Y:function(e){return y(e)&&W.call(e,"callee")&&!G.call(e,"callee")};var Z="object"==typeof exports&&exports&&!exports.nodeType&&exports,H=Z&&"object"==typeof module&&module&&!module.nodeType&&module,J=H&&H.exports===Z?u.Buffer:void 0,K=(J?J.isBuffer:void 0)||function(){return!1},X={};function ee(e){return function(t){return e(t)}}X["[object Float32Array]"]=X["[object Float64Array]"]=X["[object Int8Array]"]=X["[object Int16Array]"]=X["[object Int32Array]"]=X["[object Uint8Array]"]=X["[object Uint8ClampedArray]"]=X["[object Uint16Array]"]=X["[object Uint32Array]"]=!0,X["[object Arguments]"]=X["[object Array]"]=X["[object ArrayBuffer]"]=X["[object Boolean]"]=X["[object DataView]"]=X["[object Date]"]=X["[object Error]"]=X["[object Function]"]=X["[object Map]"]=X["[object Number]"]=X["[object Object]"]=X["[object RegExp]"]=X["[object Set]"]=X["[object String]"]=X["[object WeakMap]"]=!1;var te="object"==typeof exports&&exports&&!exports.nodeType&&exports,ne=te&&"object"==typeof module&&module&&!module.nodeType&&module,re=ne&&ne.exports===te&&o.process,oe=function(){try{var e=ne&&ne.require&&ne.require("util").types;return e||re&&re.binding&&re.binding("util")}catch(e){}}(),ie=oe&&oe.isTypedArray,ue=ie?ee(ie):function(e){return y(e)&&L(e.length)&&!!X[d(e)]},ae=Object.prototype.hasOwnProperty;function ce(e,t){var n=b(e),r=!n&&Q(e),o=!n&&!r&&K(e),i=!n&&!r&&!o&&ue(e),u=n||r||o||i,a=u?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=a.length;for(var s in e)!t&&!ae.call(e,s)||u&&("length"==s||o&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||U(s,c))||a.push(s);return a}var se,le,fe=(se=Object.keys,le=Object,function(e){return se(le(e))}),pe=Object.prototype.hasOwnProperty;function he(e){if(n=(t=e)&&t.constructor,t!==("function"==typeof n&&n.prototype||B))return fe(e);var t,n,r=[];for(var o in Object(e))pe.call(e,o)&&"constructor"!=o&&r.push(o);return r}function de(e){return null!=(t=e)&&L(t.length)&&!O(t)?ce(e):he(e);var t}var ye=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ve=/^\w*$/;function be(e,t){if(b(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!v(e))||(ve.test(e)||!ye.test(e)||null!=t&&e in Object(t))}var ge=x(Object,"create");var _e=Object.prototype.hasOwnProperty;var me=Object.prototype.hasOwnProperty;function je(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function we(e,t){for(var n=e.length;n--;)if(C(e[n][0],t))return n;return-1}je.prototype.clear=function(){this.__data__=ge?ge(null):{},this.size=0},je.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},je.prototype.get=function(e){var t=this.__data__;if(ge){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return _e.call(t,e)?t[e]:void 0},je.prototype.has=function(e){var t=this.__data__;return ge?void 0!==t[e]:me.call(t,e)},je.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ge&&void 0===t?"__lodash_hash_undefined__":t,this};var Oe=Array.prototype.splice;function Se(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Se.prototype.clear=function(){this.__data__=[],this.size=0},Se.prototype.delete=function(e){var t=this.__data__,n=we(t,e);return!(n<0)&&(n==t.length-1?t.pop():Oe.call(t,n,1),--this.size,!0)},Se.prototype.get=function(e){var t=this.__data__,n=we(t,e);return n<0?void 0:t[n][1]},Se.prototype.has=function(e){return we(this.__data__,e)>-1},Se.prototype.set=function(e,t){var n=this.__data__,r=we(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};var Ae=x(u,"Map");function ke(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function Te(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Te.prototype.clear=function(){this.size=0,this.__data__={hash:new je,map:new(Ae||Se),string:new je}},Te.prototype.delete=function(e){var t=ke(this,e).delete(e);return this.size-=t?1:0,t},Te.prototype.get=function(e){return ke(this,e).get(e)},Te.prototype.has=function(e){return ke(this,e).has(e)},Te.prototype.set=function(e,t){var n=ke(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function Ne(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var u=e.apply(this,r);return n.cache=i.set(o,u)||i,u};return n.cache=new(Ne.Cache||Te),n}Ne.Cache=Te;var Ee=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Pe=/\\(\\)?/g,Re=function(e){var t=Ne(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ee,(function(e,n,r,o){t.push(r?o.replace(Pe,"$1"):n||e)})),t}));function De(e,t){return b(e)?e:be(e,t)?[e]:Re(function(e){return null==e?"":m(e)}(e))}function Fe(e){if("string"==typeof e||v(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ze(e,t){for(var n=0,r=(t=De(t,e)).length;null!=e&&n<r;)e=e[Fe(t[n++])];return n&&n==r?e:void 0}function $e(e){var t=this.__data__=new Se(e);this.size=t.size}$e.prototype.clear=function(){this.__data__=new Se,this.size=0},$e.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},$e.prototype.get=function(e){return this.__data__.get(e)},$e.prototype.has=function(e){return this.__data__.has(e)},$e.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Se){var r=n.__data__;if(!Ae||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Te(r)}return n.set(e,t),this.size=n.size,this};var xe=Object.prototype.propertyIsEnumerable,qe=Object.getOwnPropertySymbols,Ie=qe?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var u=e[n];t(u,n,e)&&(i[o++]=u)}return i}(qe(e),(function(t){return xe.call(e,t)})))}:function(){return[]};function Me(e){return function(e,t,n){var r=t(e);return b(e)?r:function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}(r,n(e))}(e,de,Ie)}var Ue=x(u,"DataView"),Ce=x(u,"Promise"),Le=x(u,"Set"),Be=N(Ue),Ye=N(Ae),Ve=N(Ce),We=N(Le),Ge=N(q),Qe=d;(Ue&&"[object DataView]"!=Qe(new Ue(new ArrayBuffer(1)))||Ae&&"[object Map]"!=Qe(new Ae)||Ce&&"[object Promise]"!=Qe(Ce.resolve())||Le&&"[object Set]"!=Qe(new Le)||q&&"[object WeakMap]"!=Qe(new q))&&(Qe=function(e){var t=d(e),n="[object Object]"==t?e.constructor:void 0,r=n?N(n):"";if(r)switch(r){case Be:return"[object DataView]";case Ye:return"[object Map]";case Ve:return"[object Promise]";case We:return"[object Set]";case Ge:return"[object WeakMap]"}return t});var Ze=Qe,He=u.Uint8Array;function Je(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Te;++t<n;)this.add(e[t])}function Ke(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}Je.prototype.add=Je.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Je.prototype.has=function(e){return this.__data__.has(e)};function Xe(e,t,n,r,o,i){var u=1&n,a=e.length,c=t.length;if(a!=c&&!(u&&c>a))return!1;var s=i.get(e),l=i.get(t);if(s&&l)return s==t&&l==e;var f=-1,p=!0,h=2&n?new Je:void 0;for(i.set(e,t),i.set(t,e);++f<a;){var d=e[f],y=t[f];if(r)var v=u?r(y,d,f,t,e,i):r(d,y,f,e,t,i);if(void 0!==v){if(v)continue;p=!1;break}if(h){if(!Ke(t,(function(e,t){if(u=t,!h.has(u)&&(d===e||o(d,e,n,r,i)))return h.push(t);var u}))){p=!1;break}}else if(d!==y&&!o(d,y,n,r,i)){p=!1;break}}return i.delete(e),i.delete(t),p}function et(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function tt(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var nt=a?a.prototype:void 0,rt=nt?nt.valueOf:void 0;var ot=Object.prototype.hasOwnProperty;var it=Object.prototype.hasOwnProperty;function ut(e,t,n,r,o,i){var u=b(e),a=b(t),c=u?"[object Array]":Ze(e),s=a?"[object Array]":Ze(t),l="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),f="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),p=c==s;if(p&&K(e)){if(!K(t))return!1;u=!0,l=!1}if(p&&!l)return i||(i=new $e),u||ue(e)?Xe(e,t,n,r,o,i):function(e,t,n,r,o,i,u){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!i(new He(e),new He(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return C(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=et;case"[object Set]":var c=1&r;if(a||(a=tt),e.size!=t.size&&!c)return!1;var s=u.get(e);if(s)return s==t;r|=2,u.set(e,t);var l=Xe(a(e),a(t),r,o,i,u);return u.delete(e),l;case"[object Symbol]":if(rt)return rt.call(e)==rt.call(t)}return!1}(e,t,c,n,r,o,i);if(!(1&n)){var h=l&&it.call(e,"__wrapped__"),d=f&&it.call(t,"__wrapped__");if(h||d){var y=h?e.value():e,v=d?t.value():t;return i||(i=new $e),o(y,v,n,r,i)}}return!!p&&(i||(i=new $e),function(e,t,n,r,o,i){var u=1&n,a=Me(e),c=a.length;if(c!=Me(t).length&&!u)return!1;for(var s=c;s--;){var l=a[s];if(!(u?l in t:ot.call(t,l)))return!1}var f=i.get(e),p=i.get(t);if(f&&p)return f==t&&p==e;var h=!0;i.set(e,t),i.set(t,e);for(var d=u;++s<c;){var y=e[l=a[s]],v=t[l];if(r)var b=u?r(v,y,l,t,e,i):r(y,v,l,e,t,i);if(!(void 0===b?y===v||o(y,v,n,r,i):b)){h=!1;break}d||(d="constructor"==l)}if(h&&!d){var g=e.constructor,_=t.constructor;g!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof _&&_ instanceof _)&&(h=!1)}return i.delete(e),i.delete(t),h}(e,t,n,r,o,i))}function at(e,t,n,r,o){return e===t||(null==e||null==t||!y(e)&&!y(t)?e!=e&&t!=t:ut(e,t,n,r,at,o))}function ct(e){return e==e&&!j(e)}function st(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}function lt(e){var t=function(e){for(var t=de(e),n=t.length;n--;){var r=t[n],o=e[r];t[n]=[r,o,ct(o)]}return t}(e);return 1==t.length&&t[0][2]?st(t[0][0],t[0][1]):function(n){return n===e||function(e,t,n,r){var o=n.length,i=o,u=!r;if(null==e)return!i;for(e=Object(e);o--;){var a=n[o];if(u&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++o<i;){var c=(a=n[o])[0],s=e[c],l=a[1];if(u&&a[2]){if(void 0===s&&!(c in e))return!1}else{var f=new $e;if(r)var p=r(s,l,c,e,t,f);if(!(void 0===p?at(l,s,3,r,f):p))return!1}}return!0}(n,e,t)}}function ft(e,t){return null!=e&&t in Object(e)}function pt(e,t){return null!=e&&function(e,t,n){for(var r=-1,o=(t=De(t,e)).length,i=!1;++r<o;){var u=Fe(t[r]);if(!(i=null!=e&&n(e,u)))break;e=e[u]}return i||++r!=o?i:!!(o=null==e?0:e.length)&&L(o)&&U(u,o)&&(b(e)||Q(e))}(e,t,ft)}function ht(e,t){return be(e)&&ct(t)?st(Fe(e),t):function(n){var r=function(e,t,n){var r=null==e?void 0:ze(e,t);return void 0===r?n:r}(n,e);return void 0===r&&r===t?pt(n,e):at(t,r,3)}}function dt(e){return be(e)?(t=Fe(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return ze(t,e)}}(e);var t}var yt,vt=function(e,t,n){for(var r=-1,o=Object(e),i=n(e),u=i.length;u--;){var a=i[yt?u:++r];if(!1===t(o[a],a,o))break}return e};var bt=oe&&oe.isDate,gt=bt?ee(bt):function(e){return y(e)&&"[object Date]"==d(e)};function _t(e,t){var n,r={};return t="function"==typeof(n=t)?n:null==n?w:"object"==typeof n?b(n)?ht(n[0],n[1]):lt(n):dt(n),function(e,t){e&&vt(e,t,de)}(e,(function(e,n,o){!function(e,t,n){"__proto__"==t&&I?I(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}(r,n,t(e,n,o))})),r}var mt,jt=["$","¢","£","¤","¥","֏","؋","߾","߿","৲","৳","৻","૱","௹","฿","៛","₠","₡","₢","₣","₤","₥","₦","₧","₨","₩","₪","₫","€","₭","₮","₯","₰","₱","₲","₳","₴","₵","₶","₷","₸","₹","₺","₻","₼","₽","₾","₿","꠸","﷼","﹩","＄","￠","￡","￥","￦","𑿝","𑿞","𑿟","𑿠","𞋿","𞲰"],wt=/^([YN]|(TRUE)|(FALSE))$/i,Ot=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,St=/^[a-f\d]{24}$/i,At=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,kt=/^[12]\d{12}$/,Tt=/^-?[\d.,]+$/,Nt=/\d\.\d/,Et=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,Pt=/null/i;function Rt(e,t){return(e=String(e).trim()).length<30&&Tt.test(e)}var Dt=/^0+/;var Ft={TYPE_UNIQUE:{type:"unique",check:function(t,n,r){var o=n.rowCount,i=n.uniques,u=r.uniqueRowsThreshold;if(!i||0===i.length)return t;var a=i.length>=o*u;return e(e({},t),{unique:a,uniqueCount:i.length})}},TYPE_ENUM:{type:"enum",matchBasicTypes:["String","Number"],check:function(t,n,r){var o=n.rowCount,i=n.uniques,u=r.enumAbsoluteLimit,a=r.enumPercentThreshold;if(!i||0===i.length)return t;var c=Math.min(parseInt(String(o*a),10),u);return i.length>c?t:e(e({},t),{enum:i})}},TYPE_NULLABLE:{type:"nullable",check:function(t,n,r){var o=n.rowCount,i=n.uniques,u=r.nullableRowsThreshold;if(!i||0===i.length)return t;var a=0;t.types.Null&&(a+=t.types.Null.count);var c=a>=(u?o*u:0);return e(e({},t),{nullable:c,nullCount:a})}}},zt={type:"Unknown",check:function(e){return void 0===e||"undefined"===e}},$t={type:"ObjectId",supercedes:["String"],check:function(e,t){return null!=e&&((e=String(e).trim()).length<40&&St.test(e))}},xt={type:"UUID",supercedes:["String"],check:function(e,t){return null!=e&&((e=String(e).trim()).length<40&&Ot.test(e))}},qt={type:"Boolean",supercedes:["String"],check:function(e,t){return null!=e&&((e=String(e).trim()).length<=6&&wt.test(String(e)))}},It={type:"Date",supercedes:["String"],check:function(e,t){return null!=e&&(!!gt(e)||(e=String(e).trim()).length<30&&At.test(e))}},Mt={type:"Timestamp",supercedes:["String","Number"],check:function(e){return null!=e&&(e=String(e).trim(),kt.test(e))}},Ut={type:"Currency",supercedes:["String","Number"],check:function(e){if(null==e)return!1;e=String(e).trim();var t=jt.find((function(t){return e&&e.indexOf(t)>-1}));return!!t&&Rt(e=e.replace(t,""))}},Ct={type:"Float",supercedes:["String","Number"],check:function(e){return!(!Rt(String(e))||!Nt.test(String(e))||Number.isInteger(e))}},Lt={type:"Number",check:function(e,t){return!Dt.test(String(e))&&!(null===e||Array.isArray(e)||!Number.isInteger(e)&&!Rt(e))}},Bt={type:"Email",supercedes:["String"],check:function(e){return null!=e&&(!((e=String(e).trim()).includes(" ")||!e.includes("@"))&&(e.length>=5&&e.length<80&&Et.test(e)))}},Yt={type:"String",check:function(e){return"string"==typeof e}},Vt={type:"Array",check:function(e){return Array.isArray(e)}},Wt={type:"Object",check:function(e){return!Array.isArray(e)&&null!=e&&"object"==typeof e}},Gt={type:"Null",check:function(e){return null===e||Pt.test(String(e).trim())}},Qt=[zt,$t,xt,qt,It,Mt,Ut,Ct,Lt,Gt,Bt,Yt,Vt,Wt],Zt=((mt={})[zt.type]=-1,mt[$t.type]=1,mt[xt.type]=2,mt[qt.type]=3,mt[It.type]=4,mt[Mt.type]=5,mt[Ut.type]=6,mt[Ct.type]=7,mt[Lt.type]=8,mt[Gt.type]=10,mt[Bt.type]=11,mt[Yt.type]=12,mt[Vt.type]=13,mt[Wt.type]=14,mt);var Ht=Object.freeze({__proto__:null,flattenTypes:function e(t){var n={};return Object.entries(t.fields).map((function(e){var r,o=e[0],i=e[1];if(t.nestedTypes&&i.types.$ref){var u=(null===(r=i.types)||void 0===r?void 0:r.$ref).typeAlias,a=t.nestedTypes[u].totalRows;i.types.$ref.count=a}n[o]=function(e){var t,n,r,o,i,u=Object.entries(e.types),a=(u=u.slice(0).filter((function(e){return"Null"!==e[0]&&"Unknown"!==e[0]})).sort((function(e,t){return e[1].count>t[1].count?-1:e[1].count===t[1].count?0:1}))).length>0?u[0][0]:"Null",c=void 0;"Array"===a&&"$ref"===(null===(t=u[1])||void 0===t?void 0:t[0])&&(c=null===(r=null===(n=u[1])||void 0===n?void 0:n[1])||void 0===r?void 0:r.typeAlias);"$ref"===a&&(console.error("arrayOfTypes",u),c=null===(i=null===(o=u[0])||void 0===o?void 0:o[1])||void 0===i?void 0:i.typeAlias);return{identity:e.identity,type:a,typeRef:c,enum:e.enum||null,nullable:e.nullable||!1,unique:e.unique||!1}}(i)})),{schemaName:t.schemaName,fields:n,nestedTypes:t.nestedTypes?_t(t.nestedTypes,e):void 0,totalRows:t.totalRows}}}),Jt=require("debug")("schema-builder");function Kt(e){return e=e instanceof Date?e:new Date(e),!isNaN(e.getFullYear())&&e}var Xt=function(e){return(e=Kt(e))instanceof Date?e.toISOString():null},en=Ft.TYPE_ENUM,tn=Ft.TYPE_NULLABLE,nn=Ft.TYPE_UNIQUE;function rn(e,r,o){var i=this;if(void 0===o&&(o={onProgress:function(e){e.totalRows,e.currentRow},strictMatching:!0,disableNestedTypes:!1,enumMinimumRowCount:25,enumAbsoluteLimit:10,enumPercentThreshold:.01,nullableRowsThreshold:.02,uniqueRowsThreshold:.99,bogusSizeThreshold:.1}),!Array.isArray(r)||"object"!=typeof r)throw Error("Input Data must be an Array of Objects");if(r.length<1)throw Error("1 record required. 100+ recommended.");if("object"!=typeof r[0])throw Error("Input Data must be an Array of Objects");var u=o.onProgress,a=void 0===u?function(e){e.totalRows,e.currentRow}:u,c=o.strictMatching,s=void 0===c||c,l=o.disableNestedTypes,f=void 0!==l&&l,p=o.enumMinimumRowCount,h=void 0===p?25:p,d=(o.enumAbsoluteLimit,o.enumPercentThreshold,o.nullableRowsThreshold,o.uniqueRowsThreshold,r.length>=h);Jt("isEnumEnabled: "+d);var y={},v=on({schemaName:e,isEnumEnabled:d,disableNestedTypes:f,nestedData:y,strictMatching:s,onProgress:a});return Jt("Processing '"+e+"', found "+r.length+" rows..."),Promise.resolve(r).then(v).then(an).then((function(u){return t(i,void 0,void 0,(function(){var t,i,a;return n(this,(function(n){switch(n.label){case 0:return Jt("Built summary from Field Type data."),t=Object.keys(u.fields).reduce((function(e,t){var n,i=u.fields[t].types,a={rowCount:r.length,uniques:null!==(n=u.uniques[t])&&void 0!==n?n:[]};e[t]={types:i};var c=e[t];return e[t]=en.check(c,a,o),e[t]=tn.check(c,a,o),e[t]=nn.check(c,a,o),(i.Number||i.UUID||i.ObjectId)&&/^(gu|uu|_)?id/i.test(t)&&(e[t].identity=!0),u.uniques&&u.uniques[t]&&(e[t].uniqueCount=u.uniques[t].length),e}),{}),a={schemaName:e,fields:t,totalRows:u.totalRows},f?(i=void 0,[3,3]):[3,1];case 1:return[4,b(y)];case 2:i=n.sent(),n.label=3;case 3:return[2,(a.nestedTypes=i,a)]}}))}))}));function b(e){var r=this;return Object.entries(e).reduce((function(e,i){var u=i[0],a=i[1];return t(r,void 0,void 0,(function(){var t,r,i,c;return n(this,(function(n){switch(n.label){case 0:return t=u.split("."),r=t[t.length-1],i=e,c=u,[4,rn(r,a,o)];case 1:return i[c]=n.sent(),[2,e]}}))}))}),{})}}var on=function(e){var t=e.schemaName,n=e.isEnumEnabled,r=e.disableNestedTypes,o=e.nestedData,i=e.strictMatching,u=e.onProgress;return function(e){var a={uniques:n?{}:null,fieldsData:{},totalRows:null};Jt("  About to examine every row & cell. Found "+e.length+" records...");var c=un({schemaName:t,isEnumEnabled:n,disableNestedTypes:r,nestedData:o,strictMatching:i,onProgress:u}),s=e.reduce(c,a);return Jt("  Extracted data points from Field Type analysis"),s}},un=function(e){var t=e.schemaName,n=e.isEnumEnabled,r=e.disableNestedTypes,o=e.nestedData,i=e.strictMatching,u=e.onProgress;return function(e,a,c,s){e.totalRows=e.totalRows||s.length;var l=Object.keys(a);Jt("Processing Row # "+(c+1)+"/"+e.totalRows+"..."),l.forEach((function(u,c,s){var l;0===c&&Jt("Found "+s.length+" Column(s)!");var f=a[u],p=sn({value:f,strictMatching:i}),h=Object.keys(p),d=h.includes("Number")||h.includes("String")||h.includes("UUID")||h.includes("ObjectId");if(!r&&Array.isArray(f)&&f.length>=1&&"object"==typeof f[0]){var y=t+"."+u;o[y]=o[y]||[],(l=o[y]).push.apply(l,f),p.$ref=p.$ref||{rank:-12,count:c},p.$ref.typeAlias=y}n&&d&&(e.uniques[u]=e.uniques[u]||[],e.uniques[u].includes(f)||e.uniques[u].push(a[u])),e.fieldsData[u]=e.fieldsData[u]||[],e.fieldsData[u].push(p)}));var f=e.totalRows;return u&&(c+1===f||c%(f>=2500?50:f>=1e3?25:10)==0)&&u({totalRows:f,currentRow:c+1,nestedTypes:o&&Object.keys(o)}),e}};function an(e){var t=e.fieldsData,n=Object.keys(t),r={};return Jt("Pre-condenseFieldSizes(fields[fieldName]) for "+n.length+" columns"),n.forEach((function(e){var n,o,i,u,a=cn(t[e]);if(r[e]=r[e]||{types:{}},r[e].types=(i=a,u={},Jt("Starting condenseFieldSizes()"),Object.keys(i).map((function(e,t,n){u[e]={rank:Zt[e]||-42,count:i[e].count},"$ref"===e&&u[e]?u[e].typeAlias=i.$ref.typeAlias:(i[e].value&&(u[e].value=ln(i[e].value)),i[e].length&&(u[e].length=ln(i[e].length,!0)),i[e].scale&&(u[e].scale=ln(i[e].scale,!0)),i[e].precision&&(u[e].precision=ln(i[e].precision,!0))),u[e]&&["Timestamp","Date"].indexOf(e)>-1&&(u[e].value=fn(u[e].value,Xt))})),Jt("Done condenseFieldSizes()..."),u),null!==(o=null===(n=a.$ref)||void 0===n?void 0:n.count)&&void 0!==o&&o){var c=t[e].find((function(e){return e.$ref}));r[e].types.$ref.typeAlias=c.$ref.typeAlias}})),Jt("Post-condenseFieldSizes(fields[fieldName])"),Jt("Replaced fieldData with fieldSummary"),{fields:r,uniques:e.uniques||{},totalRows:e.totalRows}}function cn(e){return Jt("Processing "+e.length+" type guesses"),e.reduce((function(e,t){return Object.entries(t).map((function(t){var n=t[0],r=t[1],o=r.value,i=r.length,u=r.scale,a=r.precision;return e[n]=e[n]||{typeName:n,count:0},Number.isFinite(i)&&!e[n].length&&(e[n].length=[]),Number.isFinite(u)&&!e[n].scale&&(e[n].scale=[]),Number.isFinite(a)&&!e[n].precision&&(e[n].precision=[]),Number.isFinite(o)&&!e[n].value&&(e[n].value=[]),e[n].count++,i&&e[n].length.push(i),u&&e[n].scale.push(u),a&&e[n].precision.push(a),o&&e[n].value.push(o),e[n]})),e}),{})}function sn(t){var n=t.value,r=t.strictMatching;return function(e,t){void 0===t&&(t=!0);var n=[],r=Qt.reduce((function(t,r){return r.check(e)&&(r.supercedes&&n.push.apply(n,r.supercedes),t.push(r.type)),t}),[]);return t?r.filter((function(e){return-1===n.indexOf(e)})):r}(n,r).reduce((function(t,r,o){var i,u,a,c=o+1;if(t[r]={rank:c,count:1},"Array"===r&&(i=n.length,t[r]=e(e({},t[r]),{rank:c,count:1,length:i})),"Float"===r){n=parseFloat(String(n)),t[r]=e(e({},t[r]),{rank:c,count:1,value:n});var s=String(n).split(".");2===s.length&&(u=s.join("").length,a=s[1].length,t[r]=e(e({},t[r]),{rank:c,count:1,precision:u,scale:a}))}if("Number"===r&&(n=Number(n),t[r]=e(e({},t[r]),{rank:c,count:1,value:n})),"Date"===r||"Timestamp"===r){var l=Kt(n);l&&(t[r]=e(e({},t[r]),{rank:c,count:1,value:l.getTime()}))}return"String"!==r&&"Email"!==r||(i=String(n).length,t[r]=e(e({},t[r]),{rank:c,count:1,length:i})),t}),{})}function ln(e,t){if(void 0===t&&(t=!1),e&&!(e.length<1)){var n=e.slice().sort((function(e,t){return e<t?-1:e===t?0:1})),r=e.reduce((function(e,t){return e+t}),0);return t&&(e=n),{min:n[0],mean:r/e.length,max:n[e.length-1],p25:e[parseInt(String(.25*e.length),10)],p33:e[parseInt(String(.33*e.length),10)],p50:e[parseInt(String(.5*e.length),10)],p66:e[parseInt(String(.66*e.length),10)],p75:e[parseInt(String(.75*e.length),10)],p99:e[parseInt(String(.99*e.length),10)]}}}function fn(e,t){return{min:t(e.min),mean:t(e.mean),max:t(e.max),p25:t(e.p25),p33:t(e.p33),p50:t(e.p50),p66:t(e.p66),p75:t(e.p75),p99:t(e.p99)}}export{an as _condenseFieldData,fn as _formatRangeStats,sn as _getFieldMetadata,ln as _getNumberRangeStats,Kt as _isValidDate,cn as _pivotFieldDataByType,Ht as helpers,Xt as parseDate,rn as schemaAnalyzer};