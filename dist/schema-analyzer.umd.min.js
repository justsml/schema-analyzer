!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).schemaAnalyzer={})}(this,(function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var r=1e3,s=6e4,o=36e5,i=24*o,u=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*i;case"hours":case"hour":case"hrs":case"hr":case"h":return n*o;case"minutes":case"minute":case"mins":case"min":case"m":return n*s;case"seconds":case"second":case"secs":case"sec":case"s":return n*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return c(e,t,i,"day");if(t>=o)return c(e,t,o,"hour");if(t>=s)return c(e,t,s,"minute");if(t>=r)return c(e,t,r,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=s)return Math.round(e/s)+"m";if(t>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function c(e,t,n,r){var s=t>=1.5*n;return Math.round(e/n)+" "+r+(s?"s":"")}var a=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let o;function i(...e){if(!i.enabled)return;const t=i,r=Number(new Date),s=r-(o||r);t.diff=s,t.prev=o,t.curr=r,o=r,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let u=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,s)=>{if("%%"===r)return r;u++;const o=n.formatters[s];if("function"==typeof o){const n=e[u];r=o.call(t,n),e.splice(u,1),u--}return r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return i.namespace=e,i.enabled=n.enabled(e),i.useColors=n.useColors(),i.color=t(e),i.destroy=r,i.extend=s,"function"==typeof n.init&&n.init(i),n.instances.push(i),i}function r(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function s(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(o),...n.skips.map(o).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(t=0;t<s;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=u,Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n},l=n((function(e,t){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))}),t.splice(s,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=a(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),d=(l.log,l.formatArgs,l.save,l.load,l.useColors,l.storage,l.colors,n((function(e,n){var r="object"==typeof t&&t&&t.Object===Object&&t,s=n&&!n.nodeType&&n,o=s&&e&&!e.nodeType&&e,i=o&&o.exports===s&&r.process,u=function(){try{return i&&i.binding("util")}catch(e){}}(),c=u&&u.isDate;var a=Object.prototype.toString;var l,d=c?(l=c,function(e){return l(e)}):function(e){return function(e){return!!e&&"object"==typeof e}(e)&&"[object Date]"==a.call(e)};e.exports=d})));const f=["$","¬¢","¬£","¬§","¬•","÷è","ÿã","ﬂæ","ﬂø","‡ß≤","‡ß≥","‡ßª","‡´±","‡Øπ","‡∏ø","·üõ","‚Ç†","‚Ç°","‚Ç¢","‚Ç£","‚Ç§","‚Ç•","‚Ç¶","‚Çß","‚Ç®","‚Ç©","‚Ç™","‚Ç´","‚Ç¨","‚Ç≠","‚ÇÆ","‚ÇØ","‚Ç∞","‚Ç±","‚Ç≤","‚Ç≥","‚Ç¥","‚Çµ","‚Ç∂","‚Ç∑","‚Ç∏","‚Çπ","‚Ç∫","‚Çª","‚Çº","‚ÇΩ","‚Çæ","‚Çø","Í†∏","Ô∑º","Ôπ©","ÔºÑ","Ôø†","Ôø°","Ôø•","Ôø¶","ëøù","ëøû","ëøü","ëø†","ûãø","û≤∞"],p=/^([YN]|(TRUE)|(FALSE))$/i,h=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,g=/^[a-f\d]{24}$/i,m=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,C=/^[12]\d{12}$/,y=/^-?[\d.,]+$/,F=/\d\.\d/,b=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,w=/null/i;function S(e,t){return(e=String(e).trim()).length<30&&y.test(e)}const v=/^0+/;const k={type:"enum",matchBasicTypes:["String","Number"],check:(e,{rowCount:t,uniques:n},{enumAbsoluteLimit:r,enumPercentThreshold:s})=>{if(!n||0===n.length)return e;const o=Math.min(parseInt(String(t*s),10),r);return n.length>o?e:{enum:n,...e}}},A={type:"nullable",check:(e,{rowCount:t,uniques:n},{nullableRowsThreshold:r})=>{if(!n||0===n.length)return e;const{types:s}=e;let o=0;return s.Null&&(o+=s.Null.count),{nullable:!(o<=t*r),...e}}},R={type:"unique",check:(e,{rowCount:t,uniques:n},{uniqueRowsThreshold:r})=>{if(!n||0===n.length)return e;return{unique:n.length===t*r,...e}}},q={type:"Unknown",check:e=>void 0===e||"undefined"===e},x={type:"ObjectId",supercedes:["String"],check:function(e,t){return null!=e&&((e=String(e).trim()).length<40&&g.test(e))}},N={type:"UUID",supercedes:["String"],check:function(e,t){return null!=e&&((e=String(e).trim()).length<40&&h.test(e))}},j={type:"Boolean",supercedes:["String"],check:function(e,t){return null!=e&&((e=String(e).trim()).length<=6&&p.test(String(e)))}},T={type:"Date",supercedes:["String"],check:function(e,t){return null!=e&&(!!d(e)||(e=String(e).trim()).length<30&&m.test(e))}},O={type:"Timestamp",supercedes:["String","Number"],check:function(e){return null!=e&&(e=String(e).trim(),C.test(e))}},D={type:"Currency",supercedes:["String","Number"],check:function(e){if(null==e)return!1;e=String(e).trim();const t=f.find(t=>e.indexOf(t)>-1);return!!t&&S(e=e.replace(t,""))}},E={type:"Float",supercedes:["String","Number"],check:function(e){return!(!S(String(e))||!F.test(String(e))||Number.isInteger(e))}},I={type:"Number",check:e=>!v.test(String(e))&&!(null===e||Array.isArray(e)||!Number.isInteger(e)&&!S(e))},$={type:"Email",supercedes:["String"],check:function(e){return null!=e&&(!((e=String(e).trim()).includes(" ")||!e.includes("@"))&&(e.length>=5&&e.length<80&&b.test(e)))}},M={type:"String",check:e=>"string"==typeof e},P={type:"Array",check:e=>Array.isArray(e)},z={type:"Object",check:e=>!Array.isArray(e)&&null!=e&&"object"==typeof e},L={type:"Null",check:function(e){return null===e||w.test(String(e).trim())}},U=[q,x,N,j,T,O,D,E,I,L,$,M,P,z],B={[q.type]:-1,[x.type]:1,[N.type]:2,[j.type]:3,[T.type]:4,[O.type]:5,[D.type]:6,[E.type]:7,[I.type]:8,[L.type]:10,[$.type]:11,[M.type]:12,[P.type]:13,[z.type]:14},_=l("schema-builder:index");function J(e){return e=e instanceof Date?e:new Date(e),!isNaN(e.getFullYear())&&e}const Z=e=>(e=J(e))&&e.toISOString&&e.toISOString();function W(e){const{fieldsData:t}=e,n=Object.keys(t),r={};return _(`Pre-condenseFieldSizes(fields[fieldName]) for ${n.length} columns`),n.forEach(e=>{const n=Y(t[e]);r[e]=function(e){const t={};return _("Starting condenseFieldSizes()"),Object.keys(e).map(n=>{var r,s;t[n]={rank:B[n],count:e[n].count},e[n].value&&(t[n].value=G(e[n].value)),e[n].length&&(t[n].length=G(e[n].length,!0)),e[n].scale&&(t[n].scale=G(e[n].scale,!0)),e[n].precision&&(t[n].precision=G(e[n].precision,!0)),["Timestamp","Date"].indexOf(n)>-1&&(t[n].value=(r=t[n].value,{min:(s=Z)(r.min),mean:s(r.mean),max:s(r.max),p25:s(r.p25),p33:s(r.p33),p50:s(r.p50),p66:s(r.p66),p75:s(r.p75),p99:s(r.p99)}))}),_("Done condenseFieldSizes()..."),t}(n)}),_("Post-condenseFieldSizes(fields[fieldName])"),_("Replaced fieldData with fieldSummary"),{fields:r,uniques:e.uniques,totalRows:e.totalRows}}function Y(e){return _(`Processing ${e.length} type guesses`),e.reduce((e,t)=>(Object.entries(t).map(([t,{value:n,length:r,scale:s,precision:o}])=>(e[t]=e[t]||{typeName:t,count:0},Number.isFinite(r)&&!e[t].length&&(e[t].length=[]),Number.isFinite(s)&&!e[t].scale&&(e[t].scale=[]),Number.isFinite(o)&&!e[t].precision&&(e[t].precision=[]),Number.isFinite(n)&&!e[t].value&&(e[t].value=[]),e[t].count++,r&&e[t].length.push(r),s&&e[t].scale.push(s),o&&e[t].precision.push(o),n&&e[t].value.push(n),e[t])),e),{})}function G(e,t=!1){if(!e||e.length<1)return;const n=e.slice().sort((e,t)=>e<t?-1:e===t?0:1),r=e.reduce((e,t)=>e+t,0);return t&&(e=n),{min:n[0],mean:r/e.length,max:n[e.length-1],p25:e[parseInt(String(.25*e.length),10)],p33:e[parseInt(String(.33*e.length),10)],p50:e[parseInt(String(.5*e.length),10)],p66:e[parseInt(String(.66*e.length),10)],p75:e[parseInt(String(.75*e.length),10)],p99:e[parseInt(String(.99*e.length),10)]}}e.getNumberRangeStats=G,e.isValidDate=J,e.pivotFieldDataByType=Y,e.schemaBuilder=function(e,{onProgress:t=(({totalRows:e,currentRow:t})=>{}),strictMatching:n=!0,enumMinimumRowCount:r=100,enumAbsoluteLimit:s=10,enumPercentThreshold:o=.01,nullableRowsThreshold:i=.02,uniqueRowsThreshold:u=1}={onProgress:({totalRows:e,currentRow:t})=>{},strictMatching:!0,enumMinimumRowCount:100,enumAbsoluteLimit:10,enumPercentThreshold:.01,nullableRowsThreshold:.02,uniqueRowsThreshold:1}){if(!Array.isArray(e)||"object"!=typeof e)throw Error("Input Data must be an Array of Objects");if("object"!=typeof e[0])throw Error("Input Data must be an Array of Objects");if(e.length<5)throw Error("Analysis requires at least 5 records. (Use 200+ for great results.)");const c=e.length>=r;return _("Starting"),Promise.resolve(e).then((function(e){const t={uniques:c?{}:null,fieldsData:{},totalRows:null};_(`  About to examine every row & cell. Found ${e.length} records...`);const n=e.reduce(a,t);return _("  Extracted data points from Field Type analysis"),n})).then(W).then(t=>(_("Built summary from Field Type data."),{fields:Object.keys(t.fields).reduce((n,r)=>{const c=t.fields[r];return n[r]={types:c},n[r]=k.check(n[r],{rowCount:e.length,uniques:t.uniques&&t.uniques[r]},{enumAbsoluteLimit:s,enumPercentThreshold:o}),n[r]=A.check(n[r],{rowCount:e.length,uniques:t.uniques&&t.uniques[r]},{nullableRowsThreshold:i}),n[r]=R.check(n[r],{rowCount:e.length,uniques:t.uniques&&t.uniques[r]},{uniqueRowsThreshold:u}),(c.Number||c.UUID)&&n[r].unique&&/id$/i.test(r)&&(n[r].identity=!0),t.uniques&&t.uniques[r]&&(n[r].uniqueCount=t.uniques[r].length),n},{}),totalRows:t.totalRows}));function a(e,r,s,o){e.totalRows=e.totalRows||o.length;const i=Object.keys(r);return _(`Processing Row # ${s+1}/${e.totalRows}...`),i.forEach((t,s,o)=>{0===s&&_(`Found ${o.length} Column(s)!`);const i=function({value:e,strictMatching:t}){return function(e,t=!0){const n=[],r=U.reduce((t,r)=>(r.check(e)&&(r.supercedes&&n.push(...r.supercedes),t.push(r.type)),t),[]);return t?r.filter(e=>-1===n.indexOf(e)):r}(e,t).reduce((t,n,r)=>{let s,o,i;if(t[n]={rank:r+1},"Float"===n){e=parseFloat(e),t[n]={...t[n],value:e};const r=String(e).split(".");2===r.length&&(o=r.join("").length,i=r[1].length,t[n]={...t[n],precision:o,scale:i})}if("Number"===n&&(e=Number(e),t[n]={...t[n],value:e}),"Date"===n||"Timestamp"===n){const r=J(e);r&&(t[n]={...t[n],value:r.getTime()})}return"String"!==n&&"Email"!==n||(s=String(e).length,t[n]={...t[n],length:s}),"Array"===n&&(s=e.length,t[n]={...t[n],length:s}),t},{})}({value:r[t],strictMatching:n}),u=Object.keys(i),a=u.includes("Number")||u.includes("String");c&&a&&(e.uniques[t]=e.uniques[t]||[],e.uniques[t].includes(r[t])||e.uniques[t].push(r[t])),e.fieldsData[t]=e.fieldsData[t]||[],e.fieldsData[t].push(i)}),t({totalRows:e.totalRows,currentRow:s+1}),e}},Object.defineProperty(e,"__esModule",{value:!0})}));